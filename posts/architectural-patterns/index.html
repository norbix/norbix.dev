<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><script>(function(){const e=localStorage.getItem("theme"),t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),window.setTheme=function(e){localStorage.setItem("theme",e),document.documentElement.classList.toggle("dark",e==="dark")}})()</script><title>Architectural Patterns in Go: MVC, Hexagonal, CQRS, and Microservices | norbix.dev
</title><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
</script></head><body><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://norbix.dev/ accesskey=h title="norbix.dev - The log of my journey through code & software systems architecture (Alt + H)">norbix.dev - The log of my journey through code & software systems architecture</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://norbix.dev/ title=Home><span>Home</span></a></li><li><a href=https://norbix.dev/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://norbix.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://norbix.dev/about/ title=About><span>About</span></a></li><li><a href=https://norbix.dev/index.xml title="ğŸ“¡ RSS"><span>ğŸ“¡ RSS</span></a></li></ul></nav></header><main><main id=main><article class=post-single><header class=post-header><h1 class=post-title>Architectural Patterns in Go: MVC, Hexagonal, CQRS, and Microservices</h1><span title='2025-09-06 12:00:00 +0200 +0200'>September 6, 2025</span></header><div class=post-content><nav class=table-of-contents><nav id=TableOfContents><ul><li><a href=#-mvc-modelviewcontroller>ğŸ–¼ MVC (Modelâ€“Viewâ€“Controller)</a><ul><li><a href=#goal-keep-responsibilities-crisp>Goal: keep responsibilities crisp.</a></li><li><a href=#why-dto--dao-with-mvc>Why DTO + DAO with MVC?</a></li><li><a href=#suggested-backend-layout-go>Suggested backend layout (Go)</a></li><li><a href=#mvc-diagram>MVC Diagram.</a></li><li><a href=#-domain-model-m>ğŸ§© Domain Model (M)</a></li><li><a href=#-dao-implementation-adapter>ğŸ§° DAO Implementation (Adapter)</a></li><li><a href=#-application-service-use-case-layer>ğŸ§  Application Service (Use Case Layer)</a></li><li><a href=#-dtos-requestsresponses>ğŸ“¦ DTOs (Requests/Responses)</a></li><li><a href=#-controller-c--http-handlers>ğŸ® Controller (C) â€” HTTP Handlers</a></li><li><a href=#-wiring-main>ğŸš€ Wiring (main)</a></li><li><a href=#-checklist--tips>âœ… Checklist & Tips</a></li><li><a href=#-when-to-use>âœ… When to use:</a></li></ul></li><li><a href=#-hexagonal-architecture-ports--adapters>ğŸ›¡ Hexagonal Architecture (Ports & Adapters)</a><ul><li><a href=#minimal-go-example>Minimal Go example</a></li><li><a href=#hexagonal-diagram>Hexagonal Diagram</a></li><li><a href=#-checklist--tips-1>âœ… Checklist & Tips</a></li><li><a href=#-when-to-use-1>âœ… When to use:</a></li></ul></li><li><a href=#-cqrs-command-query-responsibility-segregation>ğŸ”€ CQRS (Command Query Responsibility Segregation)</a><ul><li><a href=#cqrs-diagram>CQRS Diagram</a></li></ul></li><li><a href=#-microservices>â˜ï¸ Microservices</a><ul><li><a href=#minimal-service-skeleton-gin>Minimal service skeleton (Gin)</a></li><li><a href=#microservice-diagram>Microservice Diagram</a></li></ul></li><li><a href=#-wrap-up-pointers>ğŸ”š Wrap-up pointers</a></li><li><a href=#-summary>ğŸ§  Summary</a><ul><li><a href=#-think-of-it-this-way>ğŸ‘‰ Think of it this way:</a></li></ul></li></ul></nav></nav><p><strong>Design patterns</strong> (like Singleton, Factory, Strategy) are reusable solutions to small-scale design problems.</p><p><strong>Architectural patterns</strong>, on the other hand, define the <strong>big picture</strong> of how systems are structured, how components interact, and how responsibilities are separated.</p><p>In this article, weâ€™ll explore four influential architectural patterns â€” <strong>MVC</strong>, <strong>Hexagonal</strong>, <strong>CQRS</strong>, and <strong>Microservices</strong> â€” and see how they apply to Go development.</p><div style=display:flex;justify-content:center><img src=banner.jpg alt="Architectural Patterns in Go" style=max-width:100%;height:auto></div><hr><h2 id=-mvc-modelviewcontroller>ğŸ–¼ MVC (Modelâ€“Viewâ€“Controller)</h2><p>The <strong>MVC pattern</strong> splits an application into three roles:</p><ul><li><strong>Model</strong> â†’ data and business logic</li><li><strong>View</strong> â†’ presentation layer (UI, HTML templates, JSON responses)</li><li><strong>Controller</strong> â†’ handles input and orchestrates between Model and View</li></ul><h3 id=goal-keep-responsibilities-crisp>Goal: keep responsibilities crisp.</h3><ul><li><p>Model (Domain): business entities + rules (no framework details).</p></li><li><p>View: JSON/HTML returned to the client.</p></li><li><p>Controller: HTTP entrypoint; validates input, calls services, shapes output.</p></li><li><p>DTO (Data Transfer Object): API-facing structs (request/response). Shields the domain from external shape changes.</p></li><li><p>DAO/Repository: persistence port; hides database from the domain. (DAO is essentially a repository here.)</p></li></ul><h3 id=why-dto--dao-with-mvc>Why DTO + DAO with MVC?</h3><ul><li><p>DTOs prevent leaking internal domain fields (e.g., hashed passwords, internal IDs) and stabilize your public API.</p></li><li><p>DAO/Repository makes business logic testable (swap Postgres for in-memory in tests) and keeps SQL out of controllers.</p></li></ul><h3 id=suggested-backend-layout-go>Suggested backend layout (Go)</h3><ul><li><p>Domain has zero dependency on infra (DB/HTTP).</p></li><li><p>Services orchestrate use cases.</p></li><li><p>Controllers adapt HTTP â†”ï¸ services and map DTO â†”ï¸ Model.</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>â”œâ”€ cmd/
</span></span><span class=line><span class=cl>â”‚  â””â”€ server/
</span></span><span class=line><span class=cl>â”‚     â””â”€ main.go                  # wire HTTP router, DI, config
</span></span><span class=line><span class=cl>â”œâ”€ internal/
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ app/
</span></span><span class=line><span class=cl>â”‚  â”‚  â”œâ”€ http/
</span></span><span class=line><span class=cl>â”‚  â”‚  â”‚  â””â”€ controllers/          # controllers (handlers) â€” â€œCâ€
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ services/                # application/services layer (use cases)
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ domain/
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ user/                    # domain models &amp; interfaces â€” â€œMâ€
</span></span><span class=line><span class=cl>â”‚  â”‚     â”œâ”€ model.go
</span></span><span class=line><span class=cl>â”‚  â”‚     â”œâ”€ repository.go         # DAO (port)
</span></span><span class=line><span class=cl>â”‚  â”‚     â””â”€ errors.go
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ infra/
</span></span><span class=line><span class=cl>â”‚  â”‚  â”œâ”€ db/                      # db bootstrapping (sqlx/gorm/pgx)
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ repository/              # DAO impls (adapters) â€” Postgres/MySQL
</span></span><span class=line><span class=cl>â”‚  â”‚     â””â”€ user_pg.go
</span></span><span class=line><span class=cl>â”‚  â””â”€ transport/
</span></span><span class=line><span class=cl>â”‚     â””â”€ http/
</span></span><span class=line><span class=cl>â”‚        â”œâ”€ router.go             # gin/chi mux + routes
</span></span><span class=line><span class=cl>â”‚        â””â”€ dto/                  # DTOs â€” request/response
</span></span><span class=line><span class=cl>â”‚           â””â”€ user.go
</span></span><span class=line><span class=cl>â”œâ”€ pkg/
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ logger/
</span></span><span class=line><span class=cl>â”‚  â””â”€ validator/
</span></span><span class=line><span class=cl>â””â”€ go.mod
</span></span></code></pre></td></tr></table></div></div><h3 id=mvc-diagram>MVC Diagram.</h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
    subgraph Client[&#34;Client (Frontend/UI)&#34;]
        A[&#34;HTTP Request\nJSON Payload&#34;]
    end

    subgraph Transport[&#34;Transport Layer&#34;]
        B[&#34;Controller\nGin/Chi Handler&#34;]
        C[&#34;DTO\nRequest/Response&#34;]
    end

    subgraph App[&#34;Application Layer&#34;]
        D[&#34;Service\nBusiness Use Case&#34;]
    end

    subgraph Domain[&#34;Domain Layer&#34;]
        E[&#34;Domain Model\nEntities &amp; Rules&#34;]
        F[&#34;Repository Interface\n(DAO Port)&#34;]
    end

    subgraph Infra[&#34;Infrastructure Layer&#34;]
        G[&#34;Repository Impl\nPostgres Adapter&#34;]
        H[(&#34;Database\nPostgres&#34;)]
    end

    A --&gt;|HTTP JSON| B
    B --&gt;|Map to DTO| C
    C --&gt;|Pass Valid Data| D
    D --&gt;|Use Entities| E
    D --&gt;|Call Port| F
    F --&gt;|Implemented by| G
    G --&gt;|SQL Queries| H
    H --&gt;|Result Rows| G
    G --&gt;|Return Entities| F
    F --&gt;|Back to| D
    D --&gt;|Domain â†’ DTO| C
    C --&gt;|JSON Response| B
    B --&gt;|HTTP Response| A
</code></pre><h3 id=-domain-model-m>ğŸ§© Domain Model (M)</h3><p>File: <code>internal/domain/user/model.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ID</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ID</span>        <span class=nx>ID</span>
</span></span><span class=line><span class=cl>	<span class=nx>Name</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Email</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Active</span>    <span class=kt>bool</span>
</span></span><span class=line><span class=cl>	<span class=nx>CreatedAt</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Domain invariants/constructors keep the model valid.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>email</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>name</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>User</span><span class=p>{},</span> <span class=nx>ErrInvalidName</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nf>isValidEmail</span><span class=p>(</span><span class=nx>email</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>User</span><span class=p>{},</span> <span class=nx>ErrInvalidEmail</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ID</span><span class=p>:</span>     <span class=nf>ID</span><span class=p>(</span><span class=nf>NewID</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Email</span><span class=p>:</span>  <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Active</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=c1>// CreatedAt set in service or repo</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>File: <code>internal/domain/user/repository.go (DAO Port)</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Repository</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Create</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>u</span> <span class=nx>User</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=nf>ByID</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=nx>ID</span><span class=p>)</span> <span class=p>(</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>ByEmail</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>email</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>List</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>limit</span><span class=p>,</span> <span class=nx>offset</span> <span class=kt>int</span><span class=p>)</span> <span class=p>([]</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>Update</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>u</span> <span class=nx>User</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=nf>Delete</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=nx>ID</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-dao-implementation-adapter>ğŸ§° DAO Implementation (Adapter)</h3><p>File: <code>internal/infra/repository/user_pg.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>repository</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;database/sql&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>domain</span> <span class=s>&#34;yourapp/internal/domain/user&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserPG</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span> <span class=o>*</span><span class=nx>sql</span><span class=p>.</span><span class=nx>DB</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewUserPG</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>sql</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=o>*</span><span class=nx>UserPG</span> <span class=p>{</span> <span class=k>return</span> <span class=o>&amp;</span><span class=nx>UserPG</span><span class=p>{</span><span class=nx>db</span><span class=p>:</span> <span class=nx>db</span><span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>UserPG</span><span class=p>)</span> <span class=nf>Create</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>u</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nf>ExecContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>`INSERT INTO users (id, name, email, active, created_at)
</span></span></span><span class=line><span class=cl><span class=s>         VALUES ($1,$2,$3,$4,$5)`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>u</span><span class=p>.</span><span class=nx>ID</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Email</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Active</span><span class=p>,</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>UTC</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>UserPG</span><span class=p>)</span> <span class=nf>ByID</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>row</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nf>QueryRowContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>`SELECT id, name, email, active, created_at FROM users WHERE id=$1`</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>u</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>row</span><span class=p>.</span><span class=nf>Scan</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>u</span><span class=p>.</span><span class=nx>ID</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>u</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>u</span><span class=p>.</span><span class=nx>Email</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>u</span><span class=p>.</span><span class=nx>Active</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>u</span><span class=p>.</span><span class=nx>CreatedAt</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>sql</span><span class=p>.</span><span class=nx>ErrNoRows</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>{},</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>ErrNotFound</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>u</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ... ByEmail, List, Update, Delete similarly</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-application-service-use-case-layer>ğŸ§  Application Service (Use Case Layer)</h3><ul><li><p>Services speak domain and depend on ports (interfaces).</p></li><li><p>Theyâ€™re trivial to unit-test with a fake repository.</p></li></ul><p>File: <code>internal/app/services/user_service.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>services</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>domain</span> <span class=s>&#34;yourapp/internal/domain/user&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserService</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>repo</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>Repository</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewUserService</span><span class=p>(</span><span class=nx>repo</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>Repository</span><span class=p>)</span> <span class=o>*</span><span class=nx>UserService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>UserService</span><span class=p>{</span><span class=nx>repo</span><span class=p>:</span> <span class=nx>repo</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>UserService</span><span class=p>)</span> <span class=nf>Register</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>email</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>u</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>domain</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>email</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// set creation time here if not in repo</span>
</span></span><span class=line><span class=cl>	<span class=nx>u</span><span class=p>.</span><span class=nx>CreatedAt</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>UTC</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>u</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>u</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>UserService</span><span class=p>)</span> <span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>ByID</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-dtos-requestsresponses>ğŸ“¦ DTOs (Requests/Responses)</h3><ul><li><p>Keep validation on DTOs (with validator).</p></li><li><p>Mapping functions isolate domain â†”ï¸ transport conversion.</p></li></ul><p>File: <code>internal/transport/http/dto/user.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>dto</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>domain</span> <span class=s>&#34;yourapp/internal/domain/user&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CreateUserRequest</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Name</span>  <span class=kt>string</span> <span class=s>`json:&#34;name&#34; validate:&#34;required,min=2&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Email</span> <span class=kt>string</span> <span class=s>`json:&#34;email&#34; validate:&#34;required,email&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserResponse</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ID</span>     <span class=kt>string</span> <span class=s>`json:&#34;id&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Name</span>   <span class=kt>string</span> <span class=s>`json:&#34;name&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Email</span>  <span class=kt>string</span> <span class=s>`json:&#34;email&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Active</span> <span class=kt>bool</span>   <span class=s>`json:&#34;active&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ToUserResponse</span><span class=p>(</span><span class=nx>u</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>)</span> <span class=nx>UserResponse</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>UserResponse</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ID</span><span class=p>:</span>     <span class=nb>string</span><span class=p>(</span><span class=nx>u</span><span class=p>.</span><span class=nx>ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=nx>u</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Email</span><span class=p>:</span>  <span class=nx>u</span><span class=p>.</span><span class=nx>Email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Active</span><span class=p>:</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Active</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-controller-c--http-handlers>ğŸ® Controller (C) â€” HTTP Handlers</h3><p>File: <code>internal/app/http/controllers/user_controller.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>controllers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;yourapp/internal/app/services&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;yourapp/internal/transport/http/dto&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>domain</span> <span class=s>&#34;yourapp/internal/domain/user&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserController</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>svc</span> <span class=o>*</span><span class=nx>services</span><span class=p>.</span><span class=nx>UserService</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewUserController</span><span class=p>(</span><span class=nx>svc</span> <span class=o>*</span><span class=nx>services</span><span class=p>.</span><span class=nx>UserService</span><span class=p>)</span> <span class=o>*</span><span class=nx>UserController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>UserController</span><span class=p>{</span><span class=nx>svc</span><span class=p>:</span> <span class=nx>svc</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>uc</span> <span class=o>*</span><span class=nx>UserController</span><span class=p>)</span> <span class=nf>Register</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>req</span> <span class=nx>dto</span><span class=p>.</span><span class=nx>CreateUserRequest</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>ShouldBindJSON</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>req</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=s>&#34;invalid_payload&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// optional: validate req with pkg/validator</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>user</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>uc</span><span class=p>.</span><span class=nx>svc</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nf>Context</span><span class=p>(),</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>Email</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>switch</span> <span class=nx>err</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>ErrInvalidEmail</span><span class=p>,</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>ErrInvalidName</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusUnprocessableEntity</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>		<span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=s>&#34;internal_error&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusCreated</span><span class=p>,</span> <span class=nx>dto</span><span class=p>.</span><span class=nf>ToUserResponse</span><span class=p>(</span><span class=nx>user</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>uc</span> <span class=o>*</span><span class=nx>UserController</span><span class=p>)</span> <span class=nf>Get</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>id</span> <span class=o>:=</span> <span class=nx>domain</span><span class=p>.</span><span class=nf>ID</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nf>Param</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>uc</span><span class=p>.</span><span class=nx>svc</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nf>Context</span><span class=p>(),</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>ErrNotFound</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=s>&#34;not_found&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=s>&#34;internal_error&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>dto</span><span class=p>.</span><span class=nf>ToUserResponse</span><span class=p>(</span><span class=nx>user</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>File: <code>internal/transport/http/router.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>http</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;yourapp/internal/app/http/controllers&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewRouter</span><span class=p>(</span><span class=nx>userCtrl</span> <span class=o>*</span><span class=nx>controllers</span><span class=p>.</span><span class=nx>UserController</span><span class=p>)</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Engine</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>New</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>gin</span><span class=p>.</span><span class=nf>Recovery</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>v1</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Group</span><span class=p>(</span><span class=s>&#34;/v1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>v1</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/users&#34;</span><span class=p>,</span> <span class=nx>userCtrl</span><span class=p>.</span><span class=nx>Register</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>v1</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/users/:id&#34;</span><span class=p>,</span> <span class=nx>userCtrl</span><span class=p>.</span><span class=nx>Get</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>r</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-wiring-main>ğŸš€ Wiring (main)</h3><p>File: <code>cmd/server/main.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;database/sql&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/lib/pq&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;yourapp/internal/app/http/controllers&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;yourapp/internal/app/services&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;yourapp/internal/infra/repository&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>transport</span> <span class=s>&#34;yourapp/internal/transport/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>sql</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;postgres&#34;</span><span class=p>,</span> <span class=s>&#34;postgres://user:pass@localhost:5432/app?sslmode=disable&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span> <span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>userRepo</span> <span class=o>:=</span> <span class=nx>repository</span><span class=p>.</span><span class=nf>NewUserPG</span><span class=p>(</span><span class=nx>db</span><span class=p>)</span>          <span class=c1>// DAO impl</span>
</span></span><span class=line><span class=cl>	<span class=nx>userSvc</span>  <span class=o>:=</span> <span class=nx>services</span><span class=p>.</span><span class=nf>NewUserService</span><span class=p>(</span><span class=nx>userRepo</span><span class=p>)</span> <span class=c1>// Service</span>
</span></span><span class=line><span class=cl>	<span class=nx>userCtrl</span> <span class=o>:=</span> <span class=nx>controllers</span><span class=p>.</span><span class=nf>NewUserController</span><span class=p>(</span><span class=nx>userSvc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>router</span> <span class=o>:=</span> <span class=nx>transport</span><span class=p>.</span><span class=nf>NewRouter</span><span class=p>(</span><span class=nx>userCtrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;listening on :8080&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:8080&#34;</span><span class=p>,</span> <span class=nx>router</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=-checklist--tips>âœ… Checklist & Tips</h3><ul><li><p>Controller: tiny; only HTTP + mapping + error codes.</p></li><li><p>DTO: versioned (e.g., /v1), validated, stable to external changes.</p></li><li><p>Service: business orchestration; no HTTP/SQL.</p></li><li><p>Domain: invariants, pure logic; no frameworks.</p></li><li><p>DAO/Repository: concrete DB code; easily mocked.</p></li><li><p>Testing: unit test services with in-memory repo; integration test DAO with a test DB.</p></li><li><p>Errors: map domain errors to HTTP status codes in controllers.</p></li><li><p>Versioning: keep DTOs under transport/http/dto/v1 if you plan multiple API versions.</p></li></ul><h3 id=-when-to-use>âœ… When to use:</h3><ul><li><p>Web applications with clear input/output flows</p></li><li><p>Great for monolithic Go services</p></li><li><p>âš ï¸ Pitfall: Controllers can easily become â€œfatâ€ if not managed well.</p></li></ul><hr><h2 id=-hexagonal-architecture-ports--adapters>ğŸ›¡ Hexagonal Architecture (Ports & Adapters)</h2><p>Idea: keep your domain core pure and push frameworks, DBs, and transports to the edges.</p><ul><li><p>Domain (core): entities, value objects, domain services, errors.</p></li><li><p>Ports: interfaces the core depends on (e.g., UserRepository, Mailer).</p></li><li><p>Adapters: implementations for ports (Postgres, Redis, SMTP, HTTP clients).</p></li><li><p>Drivers: incoming adapters (HTTP/gRPC/CLI/Jobs) that call the core.</p></li></ul><p>Suggested layout (Go)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>â”œâ”€ cmd/api/                         # app entrypoint(s)
</span></span><span class=line><span class=cl>â”‚  â””â”€ main.go
</span></span><span class=line><span class=cl>â”œâ”€ internal/
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ domain/                       # PURE core (no imports of gin/sql/http)
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ user/
</span></span><span class=line><span class=cl>â”‚  â”‚     â”œâ”€ entity.go               # entities/value objects
</span></span><span class=line><span class=cl>â”‚  â”‚     â”œâ”€ service.go              # domain services (pure)
</span></span><span class=line><span class=cl>â”‚  â”‚     â”œâ”€ ports.go                # ports (interfaces) e.g., UserRepo, Mailer
</span></span><span class=line><span class=cl>â”‚  â”‚     â””â”€ errors.go
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ app/                          # use-cases/application services
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ user/
</span></span><span class=line><span class=cl>â”‚  â”‚     â””â”€ usecase.go              # RegisterUser, ActivateUser, etc.
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ adapters/
</span></span><span class=line><span class=cl>â”‚  â”‚  â”œâ”€ in/                        # driving adapters
</span></span><span class=line><span class=cl>â”‚  â”‚  â”‚  â””â”€ http/                   # HTTP handlers (gin/chi)
</span></span><span class=line><span class=cl>â”‚  â”‚  â”‚     â”œâ”€ router.go
</span></span><span class=line><span class=cl>â”‚  â”‚  â”‚     â””â”€ user_controller.go
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ out/                       # driven adapters
</span></span><span class=line><span class=cl>â”‚  â”‚     â”œâ”€ postgres/
</span></span><span class=line><span class=cl>â”‚  â”‚     â”‚  â””â”€ user_repo.go         # implements domain.UserRepository
</span></span><span class=line><span class=cl>â”‚  â”‚     â””â”€ mail/
</span></span><span class=line><span class=cl>â”‚  â”‚        â””â”€ smtp_mailer.go       # implements domain.Mailer
</span></span><span class=line><span class=cl>â”‚  â””â”€ platform/                     # cross-cutting infra (db, config, log)
</span></span><span class=line><span class=cl>â”‚     â”œâ”€ db.go
</span></span><span class=line><span class=cl>â”‚     â”œâ”€ config.go
</span></span><span class=line><span class=cl>â”‚     â””â”€ logger.go
</span></span><span class=line><span class=cl>â””â”€ go.mod
</span></span></code></pre></td></tr></table></div></div><h3 id=minimal-go-example>Minimal Go example</h3><p>File: <code>internal/domain/user/ports.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Repository</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Save</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>u</span> <span class=nx>User</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=nf>ByID</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=nx>ID</span><span class=p>)</span> <span class=p>(</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Mailer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>SendWelcome</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>email</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>File: <code>internal/app/user/usecase.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>userapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>domain</span> <span class=s>&#34;yourapp/internal/domain/user&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>RegisterUser</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Repo</span>   <span class=nx>domain</span><span class=p>.</span><span class=nx>Repository</span>
</span></span><span class=line><span class=cl>	<span class=nx>Mailer</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>Mailer</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>uc</span> <span class=nx>RegisterUser</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>email</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>u</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>domain</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>email</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>uc</span><span class=p>.</span><span class=nx>Repo</span><span class=p>.</span><span class=nf>Save</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>u</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>domain</span><span class=p>.</span><span class=nx>User</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=p>=</span> <span class=nx>uc</span><span class=p>.</span><span class=nx>Mailer</span><span class=p>.</span><span class=nf>SendWelcome</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Email</span><span class=p>)</span> <span class=c1>// best-effort, log on failure</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>u</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=hexagonal-diagram>Hexagonal Diagram</h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
    subgraph Drivers[&#34;Drivers (Incoming Adapters)&#34;]
        A[&#34;HTTP\n(gin/chi)&#34;]
        B[&#34;CLI\nCron/Jobs&#34;]
        C[&#34;gRPC\nGateway&#34;]
    end

    subgraph Core[&#34;Core (Domain + Application)&#34;]
        D[&#34;Application Services\nUse Cases&#34;]
        E[&#34;Domain Entities\nValue Objects\nDomain Services&#34;]
        F[&#34;Ports\n(Repo, Mailer, Cache)&#34;]
    end

    subgraph Adapters[&#34;Driven Adapters (Infra)&#34;]
        G[&#34;Postgres Repo\nimplements Repo&#34;]
        H[&#34;SMTP Mailer\nimplements Mailer&#34;]
        I[&#34;Redis Cache\nimplements Cache&#34;]
    end

    A --&gt; D
    B --&gt; D
    C --&gt; D
    D --&gt; E
    D --&gt; F
    F --&gt; G
    F --&gt; H
    F --&gt; I
</code></pre><h3 id=-checklist--tips-1>âœ… Checklist & Tips</h3><ul><li><p>Keep internal/domain import-clean (no framework/DB imports).</p></li><li><p>Define ports in the domain; implement them in adapters.</p></li><li><p>Tests: unit-test use-cases with fakes for ports; integration-test adapters.</p></li></ul><h3 id=-when-to-use-1>âœ… When to use:</h3><ul><li><p>Systems with high read/write load</p></li><li><p>Event-sourced systems (CQRS often pairs with Event Sourcing)</p></li><li><p>âš ï¸ Pitfall: Adds complexity â€” not always worth it for simple apps.</p></li></ul><hr><h2 id=-cqrs-command-query-responsibility-segregation>ğŸ”€ CQRS (Command Query Responsibility Segregation)</h2><p>CQRS separates read and write responsibilities into different models:</p><p>Commands â†’ update state (writes)</p><p>Queries â†’ read state (reads)</p><p>This avoids having one bloated model handling both responsibilities.</p><p>ğŸ“ <strong>Go Example</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Command Handler</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>CreateUser</span><span class=p>(</span><span class=nx>repo</span> <span class=nx>UserRepository</span><span class=p>,</span> <span class=nx>user</span> <span class=nx>User</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>repo</span><span class=p>.</span><span class=nf>Save</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Query Handler</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetUser</span><span class=p>(</span><span class=nx>repo</span> <span class=nx>UserRepository</span><span class=p>,</span> <span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>repo</span><span class=p>.</span><span class=nf>Find</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cqrs-diagram>CQRS Diagram</h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
    subgraph API[&#34;API Layer&#34;]
        A[&#34;HTTP Endpoints\n/commands\n/queries&#34;]
    end

    subgraph WriteSide[&#34;Write Side&#34;]
        B[&#34;Command Handler\n(Validate + Execute)&#34;]
        C[&#34;Write Model\n(Domain + Repo)&#34;]
        D[(&#34;Write DB&#34;)]
    end

    subgraph ReadSide[&#34;Read Side&#34;]
        E[&#34;Projector\n(Update Projections)&#34;]
        F[&#34;Read Model\n(DTO Repository)&#34;]
        G[(&#34;Read DB&#34;)]
        H[&#34;Query Handler\n(Reads Only)&#34;]
    end

    subgraph Bus[&#34;Event Bus (Optional)&#34;]
        X[&#34;Domain Events&#34;]
    end

    %% Command path
    A --&gt;|POST /commands| B
    B --&gt; C
    C --&gt; D
    C --&gt;|Emit Events| X

    %% Projection path
    X --&gt; E
    E --&gt; F
    F --&gt; G

    %% Query path
    A --&gt;|GET /queries| H
    H --&gt; F

    %% Notes
    classDef dim fill:#f7f7f7,stroke:#bbb,color:#333
    class API,WriteSide,ReadSide,Bus dim
</code></pre><p>âœ… When to use:</p><ul><li><p>Systems with high read/write load</p></li><li><p>Event-sourced systems (CQRS often pairs with Event Sourcing)</p></li><li><p>âš ï¸ Pitfall: Adds complexity â€” not always worth it for simple apps.</p></li></ul><hr><h2 id=-microservices>â˜ï¸ Microservices</h2><p>A Microservices architecture structures applications as a collection of small, independent services:</p><ul><li><p>Each service owns its data and logic</p></li><li><p>Services communicate via APIs (HTTP, gRPC, messaging)</p></li><li><p>Each can be deployed and scaled independently</p></li></ul><p>Idea: split a system into small, independently deployable services that each own their data and domain.</p><p>Services communicate via synchronous (HTTP/gRPC) or asynchronous (Kafka/NATS) channels.</p><p>Each service has its own database (no shared schema).</p><p>Requires solid platform engineering: CI/CD, observability, API governance, SLOs.</p><p>Suggested repo layout (mono-repo)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>â”œâ”€ services/
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ usersvc/
</span></span><span class=line><span class=cl>â”‚  â”‚  â”œâ”€ cmd/usersvc/main.go
</span></span><span class=line><span class=cl>â”‚  â”‚  â”œâ”€ internal/...
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ api/openapi.yaml
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ ordersvc/
</span></span><span class=line><span class=cl>â”‚  â”‚  â”œâ”€ cmd/ordersvc/main.go
</span></span><span class=line><span class=cl>â”‚  â”‚  â”œâ”€ internal/...
</span></span><span class=line><span class=cl>â”‚  â”‚  â””â”€ api/openapi.yaml
</span></span><span class=line><span class=cl>â”‚  â””â”€ paymentsvc/
</span></span><span class=line><span class=cl>â”‚     â”œâ”€ cmd/paymentsvc/main.go
</span></span><span class=line><span class=cl>â”‚     â”œâ”€ internal/...
</span></span><span class=line><span class=cl>â”‚     â””â”€ api/openapi.yaml
</span></span><span class=line><span class=cl>â”œâ”€ pkg/                         # shared libs (careful: avoid domain leakage)
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ logger/
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ tracing/
</span></span><span class=line><span class=cl>â”‚  â””â”€ httpx/
</span></span><span class=line><span class=cl>â”œâ”€ deploy/
</span></span><span class=line><span class=cl>â”‚  â”œâ”€ k8s/                      # Helm/Manifests
</span></span><span class=line><span class=cl>â”‚  â””â”€ infra/                    # Terraform (DBs, queues, buckets)
</span></span><span class=line><span class=cl>â””â”€ Makefile / Taskfile.yaml
</span></span></code></pre></td></tr></table></div></div><h3 id=minimal-service-skeleton-gin>Minimal service skeleton (Gin)</h3><p>File: <code>services/usersvc/cmd/usersvc/main.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>New</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>gin</span><span class=p>.</span><span class=nf>Recovery</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/v1/users/:id&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;id&#34;</span><span class=p>:</span> <span class=nx>c</span><span class=p>.</span><span class=nf>Param</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>),</span> <span class=s>&#34;name&#34;</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;usersvc listening on :8081&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:8081&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=microservice-diagram>Microservice Diagram</h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
    subgraph Clients[&#34;Clients&#34;]
        A[&#34;Web\nMobile&#34;]
    end

    subgraph Edge[&#34;API Gateway\nIngress&#34;]
        B[&#34;Routing\nAuth\nRate Limit&#34;]
    end

    subgraph Services[&#34;Microservices&#34;]
        U[&#34;User Service\nDB owned by service&#34;]
        O[&#34;Order Service\nDB owned by service&#34;]
        P[&#34;Payment Service\nDB owned by service&#34;]
    end

    subgraph Async[&#34;Async Messaging&#34;]
        K[&#34;Kafka/NATS\nTopics&#34;]
    end

    A --&gt; B
    B --&gt; U
    B --&gt; O
    B --&gt; P

    O &lt;--&gt;|Events| K
    P &lt;--&gt;|Events| K
    U &lt;--&gt;|Events| K
</code></pre><p>âœ… Checklist & Tips</p><ul><li><p>Start with modular monolith â†’ extract services when boundaries stabilize.</p></li><li><p>Each service: own DB schema, own CI, own versioning.</p></li><li><p>Invest early in observability (traces, logs, metrics) and API contracts.</p></li></ul><p>âœ… When to use:</p><ul><li><p>Large, complex systems needing scalability</p></li><li><p>Teams working on independent modules</p></li><li><p>âš ï¸ Pitfall: Operational overhead (DevOps, CI/CD, observability, networking).</p></li></ul><hr><h2 id=-wrap-up-pointers>ğŸ”š Wrap-up pointers</h2><ul><li><p>Hexagonal: best baseline for testability and longevity; add adapters as you go.</p></li><li><p>CQRS: apply where read/write divergence brings value; donâ€™t over-split prematurely.</p></li><li><p>Microservices: only when team size, domain boundaries, and scaling needs justify the operational cost.</p></li></ul><hr><h2 id=-summary>ğŸ§  Summary</h2><ul><li><p>MVC â†’ Clear separation of concerns in monolithic apps</p></li><li><p>Hexagonal â†’ Isolate core logic, improve testability</p></li><li><p>CQRS â†’ Split reads and writes for clarity and scalability</p></li><li><p>Microservices â†’ Independent, scalable services for large systems</p></li></ul><h3 id=-think-of-it-this-way>ğŸ‘‰ Think of it this way:</h3><ul><li><p>Design patterns = small tools (Singleton, Observer, Strategy)</p></li><li><p>Architectural patterns = the blueprint of the entire building</p></li><li><p>Both are essential, but at different levels of abstraction.</p></li></ul><hr><p>ğŸš€ Follow me on <a href=https://norbix.dev>norbix.dev</a> for more insights on Go, Python, AI, system design, and engineering wisdom.</p></div><div class=post-subscribe><style>.subscribe-form{display:flex;gap:.5rem;margin-top:1rem;align-items:center}.subscribe-form input[type=email]{padding:.5rem;border-radius:6px;border:1px solid #ccc;background-color:#1f1f1f;color:#fff}.subscribe-form input[type=submit],.subscribe-form button{padding:.5rem 1rem;border-radius:6px;background-color:#facc15;color:#000;border:none;cursor:pointer;font-weight:700}.subscribe-form input[type=submit]:hover{background-color:#fcd34d}</style><form action=https://buttondown.email/api/emails/embed-subscribe/norbix method=post target=popupwindow onsubmit='window.open("https://buttondown.email/norbix","popupwindow")' class=subscribe-form><input type=email name=email placeholder="Enter your email" required>
<input type=submit value=Subscribe></form><p style=font-size:.875rem;opacity:.6>Powered by Buttondown.</p></div><div class=post-comments><script src=https://giscus.app/client.js data-repo=norbix/norbix.dev data-repo-id=R_kgDOOV_xMQ data-category=Announcements data-category-id=DIC_kwDOOV_xMc4CpF5M data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=dark data-lang=en crossorigin=anonymous async></script></div><nav class=paginav><a class=prev href=https://norbix.dev/posts/artificial-intelligence/><span class=title>Â« Prev</span><br><span>Demystifying Artificial Intelligence: AI, Machine Learning, and Deep Learning</span>
</a><a class=next href=https://norbix.dev/posts/api-styles-and-contracts/><span class=title>Next Â»</span><br><span>REST vs GraphQL vs WebSocket vs gRPC: API Styles and Contracts in Go</span></a></nav></article></main></main><footer class=footer><span>&copy; 2025 <a href=https://norbix.dev/>norbix.dev - The log of my journey through code & software systems architecture</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script src=https://platform.linkedin.com/badges/js/profile.js async defer type=text/javascript></script></body></html>